/*
 * FunctionStatistic.cpp
 *
 *  Created on: May 10, 2012
 *      Author: hsqfire
 */

#include "FunctionStatistic.h"
#include "llvm/Support/raw_ostream.h"

using namespace std;
using namespace esp;
using namespace llvm;

void LockData::printStatistic(){
  if(isLockWrapper)
    cout<<"is lock wrapper"                                       <<"\n";
  if(isUnlockWrapper)
    cout<<"is unlock wrapper"                                   <<"\n";

  // Print out lock pattern
  cout<<"*Overall lock usages:"<<lockUsage        <<"\n";
  cout<<"*special lock pattern:"                               <<"\n";
  cout<<"lock..unlock: "   <<directLockNumber      <<"\n";
  cout<<"if..lock..if..unlock: "<<ifLockNumber        <<"\n";
  cout<<"if(lock): "           <<testLockNumber         <<"\n";
  cout<<"other patterns:" <<otherNumber              <<"\n";

  // Print out call deep of each lock
  cout<<"*call deep: "      <<callDeep                      <<"\n";

  // Print out the lock type
  string typeName = type->getType()->getDescription();
  cout<<"*lock type: "      <<typeName                   <<"\n";
}

void FunctionStatistic::printStatistic(){
  cout<<"function: "<<functionName<<"\n";

  cout<<"--------------------------------------"                  <<"\n";

  // Print out lock number and lock names
  for(map<Value*, LockData*>::iterator it = locks.begin();
      it != locks.end(); it++){
    cout<<"*lock number: "<<lockNumber                <<"\n";
    cout<<"*lock names: "                                           <<"\n";
    cout<<getValueName((*it).first)                            <<"\n";
    (*it).second->printStatistic();
  }

  cout<<"static lock: "      <<staticLockNumber      <<"\n";
  cout<<"dynamic Lock: "<< dynamicLockNumber<<"\n";
  cout<<"global lock: "     <<globalLockNumber     <<"\n";
  cout<<"local lock: "        <<localLockNumber      <<"\n";

  if(recursiveLock)
    cout<<"recursive lock"                                         <<"\n";

  // End
  cout<<endl;
}



