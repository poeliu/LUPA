/*
 * LockStatistic.cpp
 *
 *  Created on: Apr 11, 2012
 *      Author: hsqfire
 */

#include "LockStatistic.h"
#include "llvm/Support/raw_ostream.h"

using namespace std;
using namespace esp;
using namespace llvm;

void LockStatistic::printStatistic(){
  cout<<"function: "<<functionName<<"\n";

  cout<<"--------------------------------------"                  <<"\n";

  // Print out lock number and lock names
  cout<<"*lock number: "<<lockNumber                <<"\n";
  cout<<"*lock names: "                                           <<"\n";
  for(set<string>::iterator it = lockNames.begin();
      it != lockNames.end(); it++)
    cout<<(*it)<<"\n";

  // Print out lock pattern
  cout<<"*special lock pattern:"                               <<"\n";
  cout<<"lock..unlock: "   <<directLockNumber      <<"\n";
  cout<<"if..lock..if..unlock: "<<ifLockNumber        <<"\n";
  cout<<"if(lock): "           <<testLockNumber         <<"\n";
  cout<<"static lock: "      <<staticLockNumber      <<"\n";
  cout<<"dynamic Lock: "<< dynamicLockNumber<<"\n";
  cout<<"global lock: "     <<globalLockNumber     <<"\n";
  cout<<"local lock: "        <<localLockNumber      <<"\n";

  // Print out call deep of each lock
  cout<<"*call deep of each lock"                            <<"\n";
  for(map<string, uint>::iterator it = callDeep.begin();
      it != callDeep.end(); it++)
    cout<<(*it).first<<": "<<(*it).second                  <<"\n";

  // Print out original lock variables
  cout<<"*original lock variables: "                          <<"\n";
  for(set<Value*>::iterator it = originalLocks.begin();
      it != originalLocks.end(); it++){
    if(isa<Instruction>((*it))){
      Instruction *inst = dyn_cast<Instruction>((*it));
      llvm::outs()<<(*inst)                                          <<"\n";
    }else{
      cout<<(*it)->getNameStr()                             <<"\n";
    }
  }

  // End
  cout<<endl;
}


